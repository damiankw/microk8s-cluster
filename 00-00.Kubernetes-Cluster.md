# Kubernetes Cluster

The idea here is to install and run a Kubernetes cluster on HP EliteDesk Mini's. These mini's pack a punch when it comes to the hardware inside of them. I'm using a mixture of the following hardware for my setup:

- HP EliteDesk 800 G5 Mini 7YY06PA [i7-9700T, 2 x 256GB NVMe, 2 x 8GB RAM]
- HP EliteDesk 800 G5 Mini 7YX38PA [i5-9500T, 2 x 256GB NVMe, 2 x 8GB RAM]

I want to configure these with local disk redundancy in case of disk failure, so instead of losing a node in the cluster I can gracefully stop it and replace the disk before there's a real issue.

# Get hardware ready
Before going onto the operating system I first started with the system itself. The basics of this is installing the disks in the order I wanted them, I always install disks using serial number, lowest to highest, that way if I need to do diagnosis later it's easy.

I also run a firmware update on BIOS, with HP machines this is too simple, just go into the BIOS and update firmware, voila.

Check that the system recognises the disks and the memory and you're typically golden. For extra measure I could have run some checks on these using the HP utilities, but I didn't feel the need.

# Install Ubuntu

When installing Ubuntu I needed to go through a bit of a process to get the disks the way I wanted, I had to create the following partitions on the disks:

| Device  | Partition | Size    | Type   | Mount Point |
|---------|-----------|---------|--------|-------------|
| NVMe01  | 01        | 1GB     | FAT32  | /boot/efi   |
| NVMe01  | 02        | 2GB     | RAID1  | /boot       |
| NVMe01  | 03        | ~230GB  | RAID1  | /           |
|---------|-----------|---------|--------|-------------|
| NVMe02  | 01        | 1GB     | FAT32  | /boot/efi   |
| NVMe02  | 02        | 2GB     | RAID1  | /boot       |
| NVMe02  | 03        | ~230GB  | RAID1  | /           |

How I achieved this was to do a bit of manual configuration of the disks. At the 'Guided storage configuration' step of installation select 'Custom storage layout' and then go through the following steps:

Create the partitions:
- Select disk 1, whack enter and select Reformat > Reformat
- Select disk 1 free space, whack enter and select Add GPT Partition > Size (1G); Format (Leave unformatted) > Create
- Select disk 1 free space, whack enter and select Add GPT Partition > Size (2G); Format (Leave unformatted) > Create
- Select disk 1 free space, whack enter and select Add GPT Partition > Size (leave empty); Format (Leave unformatted) > Create
- Select disk 2, whack enter and select Reformat > Reformat
- Select disk 2 free space, whack enter and select Add GPT Partition > Size (1G); Format (Leave unformatted) > Create
- Select disk 2 free space, whack enter and select Add GPT Partition > Size (2G); Format (Leave unformatted) > Create
- Select disk 2 free space, whack enter and select Add GPT Partition > Size (leave empty); Format (Leave unformatted) > Create

Create the Array (RAID1):
- Select Create software RAID (md), whack enter and select the two 2G partitions from the two disks > Create
- Select Create software RAID (md), whack enter and select the two ~230G partitions from the two disks > Create
You might have noticed we didn't create an array out of the 1GB partition, this is going to be our boot partition the system picks up on, so it needs to be separated so the system can read it.

Create the file system mounts:
- Select md0 free space, whack enter and select Add GPT Partition > Mount (/boot) > Create
- Select md0 free space, whack enter and select Add GPT Partition > Mount (/) > Create

This will create the /boot and / file systems. If you want to separate anything else, you can do it here.

Once you're done, you should have a file system table that looks something like what's below, you can go ahead and whack Done!

| MOUNT POINT | SIZE  | TYPE      | DEVICE TYPE                      |
|-------------|-------|-----------|----------------------------------|
| /           | ~230G | new ext4  | new partition of software RAID 1 |
| /boot       | 2G    | new ext4  | new partition of software RAID 1 |
| /boot/efi   | 1G    | new fat32 | new partition of local disk      |

The rest of the installation do as normal, however during the 'Featured server snaps' I selected to install microk8s, as that's what I want to build my Kubernetes cluster with.

I also recommend that if you haven't already, that you use Github to manage your SSH keys. When you enable OpenSSH Server on Ubuntu installation you can then select to download them from Github and voila, instant access.

